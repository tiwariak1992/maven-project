pipeline
{
    agent any
    stages
    {
        stage('scm checkout')
        {
            steps
            {
                git 'https://github.com/tiwariak1992/maven-project.git'
            }
        }
        stage('compile')
        {
            steps
            {
                withMaven(jdk:'local-jenkins',maven:'localmaven')
                {
                    sh 'mvn compile'
                }
            }
         }
            stage('test')
            {
                steps
                  {
                   withMaven(jdk:'local-jenkins',maven:'localmaven')
                   {
                    sh 'mvn test'
                   }
                  }
            }
            stage('install')
            {
                steps
                {
                    withMaven(jdk:'local-jenkins',maven:'localmaven')
                    {
                        sh'mvn install'
                    }
                }
            }
            stage('ci-cd pipeline with ansible')
            {
                steps
                {
                    sshPublisher(publishers: [sshPublisherDesc(configName: 'ansible', transfers: [sshTransfer(cleanRemote: false, excludes: '', execCommand: 'ansible-playbook /etc/ansible/playbooks/deploy.yml', execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: '[, ]+', remoteDirectory: '//etc//ansible//playbooks', remoteDirectorySDF: false, removePrefix: '', sourceFiles: 'webapp/target/*.war')], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])
                }
            }
        
    }
}
